# DataJpaTest와 TestContainers 비교

## DataJpaTest

### 장점
- **간편한 설정**: `@DataJpaTest` 어노테이션만으로 JPA 관련 테스트를 위한 슬라이스 테스트 환경이 자동으로 구성됩니다.
- **빠른 실행 속도**: 인메모리 데이터베이스(H2 등)를 사용하므로 테스트 실행 속도가 빠릅니다.
- **자동 롤백**: 테스트마다 트랜잭션이 자동으로 롤백되어 테스트 격리가 보장됩니다.
- **가벼운 리소스 사용**: 실제 DB 컨테이너를 실행하지 않아 시스템 리소스 사용이 적습니다.
- **개발 편의성**: CI/CD 환경에서 별도 설정 없이 바로 실행 가능합니다.

### 단점
- **환경 차이**: 실제 운영 DB와 다른 인메모리 DB를 사용하므로 운영 환경과의 차이가 발생할 수 있습니다.
- **특정 DB 기능 테스트 제한**: MySQL, PostgreSQL 등 특정 DB의 고유 기능을 테스트하기 어렵습니다.
- **DDL 차이**: 다른 DB 엔진을 사용하면 DDL 문법 차이로 인한 문제가 발생할 수 있습니다.

## TestContainers

### 장점
- **실제 DB 환경**: 실제 운영에서 사용하는 것과 동일한 DB 엔진을 Docker 컨테이너로 실행하여 테스트합니다.
- **높은 신뢰성**: 운영 환경과 동일한 DB 환경으로 테스트하므로 환경 차이로 인한 오류 가능성이 낮습니다.
- **DB 특화 기능 테스트**: 특정 데이터베이스의 고유 기능(MySQL JSON 타입, PostgreSQL의 jsonb 등)을 테스트할 수 있습니다.
- **통합 테스트 용이**: 다른 컨테이너(Redis, Kafka 등)와 함께 전체 시스템 통합 테스트를 구성할 수 있습니다.
- **멱등성(Idempotency)**: 매번 깨끗한 상태의 DB 컨테이너로 테스트하므로 테스트 실행 순서와 무관하게 일관된 결과를 보장합니다.

### 단점
- **리소스 사용량**: Docker 컨테이너를 실행하므로 시스템 리소스를 많이 사용합니다.
- **실행 속도**: 컨테이너 시작 시간으로 인해 테스트 실행 속도가 느릴 수 있습니다.
- **복잡한 설정**: 컨테이너 설정, 네트워크, 볼륨 등 추가 설정이 필요할 수 있습니다.
- **CI/CD 환경 제약**: CI/CD 환경에서 Docker 지원이 필요합니다.

## 이 프로젝트에 대한 권장 사항

현재 Attendly 프로젝트의 상황과 특성을 고려했을 때, 다음과 같은 테스트 전략을 권장합니다:

### 권장: 혼합 접근 방식(Hybrid Approach)

1. **단위 테스트와 간단한 리포지토리 테스트**: `@DataJpaTest`를 사용
   - 현재처럼 간단한 리포지토리 테스트, 쿼리 검증 등에 활용
   - 빠른 피드백 루프를 위한 개발 중 테스트에 적합

2. **통합 테스트와 중요 기능 테스트**: TestContainers 사용
   - 실제 MySQL 데이터베이스 특화 기능을 사용하는 쿼리나 기능 테스트
   - 배포 전 최종 검증을 위한 통합 테스트에 활용
   - CI/CD 파이프라인의 주요 검증 단계에서 실행

### 구현 전략

1. `application-test.yml` 구성을 두 가지로 분리
   - `application-datajpatest.yml`: H2 데이터베이스 설정 (현재 사용 중)
   - `application-testcontainers.yml`: TestContainers MySQL 설정

2. 테스트 기반 클래스 생성
   - 기본 `DataJpaTestBase` 클래스: 일반적인 리포지토리 테스트용
   - `TestContainersBase` 클래스: MySQL 특화 기능 테스트용

3. 테스트 실행 효율화
   - TestContainers의 재사용 기능(reuse) 활성화
   - 여러 테스트 클래스 간에 동일한 컨테이너 인스턴스 공유

이 혼합 접근 방식은 개발 속도와 테스트 신뢰성 사이의 균형을 맞추며, 프로젝트가 성장함에 따라 점진적으로 TestContainers의 비중을 늘려갈 수 있는 유연성을 제공합니다. 